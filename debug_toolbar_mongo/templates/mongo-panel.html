{% load mongo_debug_tags %}

{% if queries %}
<table>
  <thead>
    <tr>
      <th>Command</th>
      <th>Collection</th>
      <th>Query</th>
      <th>Comment</th>
      <th>Time (ms)</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
  {% for query in queries %}
    <tr>
      <td>{{ query.type }}</td>
      <td>{{ query.collection }}</td>
      <td>
        <table class="inner">
          <tr><td colspan="2">{{ query.query }}</td></tr>
          {% if query.projection %}
            <tr><td class="muted">Project</td><td>{{ query.projection }}</td></tr>
          {% endif %}
          {% if query.ordering %}
            <tr><td class="muted">Sort</td><td>{{ query.ordering }}</td></tr>
          {% endif %}
          {% if query.skip %}
            <tr><td class="muted">Skip</td><td>{{ query.skip }}</td></tr>
          {% endif %}
          {% if query.limit %}
            <tr><td class="muted">Limit</td><td>{{ query.limit }}</td></tr>
          {% endif %}
        </table>
      </td>
      <td>{% if query.comment %}{{ query.comment }}{% endif %}</td>
      <td>{{ query.time|floatformat }}</td>
      <td>
        <button class="djdt-mongo-btn-explain" data-query-idx="{{ forloop.counter0 }}">Expl</button>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
  <p>No queries recorded</p>
{% endif %}

{{ queries|json_script:'djdt-mongo-json-queries' }}

<style>
  #djDebug table.inner td.muted {
      color: #aaa;
      width: 40px;
      {#white-space: nowrap;#}
  }
  #djDebug table.inner{
      margin: 0;
      border: none;
      background-color: transparent;
  }
  #djDebug table.inner tr{
      background-color: transparent !important;
  }
</style>